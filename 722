import json
import csv

# Function to flatten JSON and extract key-value pairs
def extract_values(obj, parent_key=""):
    key_values = []
    if isinstance(obj, dict):
        for k, v in obj.items():
            full_key = f"{parent_key}.{k}" if parent_key else k
            key_values.extend(extract_values(v, full_key))
    elif isinstance(obj, list):
        for i, item in enumerate(obj):
            full_key = f"{parent_key}[{i}]"
            key_values.extend(extract_values(item, full_key))
    else:
        key_values.append((parent_key, obj))
    return key_values

# Load JSON data
json_file_path = 'path_to_your_json_file.json'  # Replace with the path to your JSON file
output_csv_path = 'output_values.csv'  # Desired output CSV file path

try:
    with open(json_file_path) as json_file:
        json_data = json.load(json_file)
except FileNotFoundError:
    print(f"File not found: {json_file_path}")
    exit(1)
except json.JSONDecodeError:
    print(f"Error decoding JSON from file: {json_file_path}")
    exit(1)

# Extract data from JSON
flat_data = extract_values(json_data)

# Extract unique headers
headers = sorted(set(key for key, _ in flat_data))

# Write to CSV
with open(output_csv_path, mode='w', newline='', encoding='utf-8') as csv_file:
    writer = csv.writer(csv_file)
    writer.writerow(headers)
    
    # Prepare a dictionary for row values based on headers
    row_dict = {header: '' for header in headers}
    for key, value in flat_data:
        row_dict[key] = value

    # Write the row to the CSV file
    writer.writerow([row_dict[header] for header in headers])

print(f"CSV file saved at: {output_csv_path}")
