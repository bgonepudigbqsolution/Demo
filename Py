import json
import pandas as pd

# Load the JSON data from file
with open(r'C:\repo\json\PROD\PA.json') as json_file:
    jsondata = json.load(json_file)

# Function to flatten JSON and get key-value pairs
def flatten_json(json_obj, parent_key='', sep='.'):
    items = {}
    for k, v in json_obj.items():
        new_key = f"{parent_key}{sep}{k}" if parent_key else k
        if isinstance(v, dict):
            items.update(flatten_json(v, new_key, sep=sep))
        elif isinstance(v, list):
            for i, item in enumerate(v):
                items.update(flatten_json(item, f"{new_key}[{i}]", sep=sep))
        else:
            items[new_key] = v
    return items

# Ensure jsondata is a list
if isinstance(jsondata, dict):
    jsondata = [jsondata]

# Flatten each JSON entry and create a DataFrame
flattened_data = [flatten_json(entry) for entry in jsondata]
df = pd.DataFrame(flattened_data)

# Write to CSV
csv_file_path = r'C:\repo\json\PROD\PA.csv'
df.to_csv(csv_file_path, index=False)

print(f"Data successfully written to {csv_file_path}")
